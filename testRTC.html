<!DOCTYPE html>
<!DOCTYPE html>
<html>
<head>
	<title>test</title>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
</head>
<body>
<video autoplay style="width: 500px;height: 500px"></video>
	<script type="text/javascript">
		const socket = io('https://pratibha-rtc.herokuapp.com/');
		socket.on('connect', function(){
		  socket.emit('join_room',JSON.stringify({me:"pratibha"}))
		});
		var pc;
		var configuration = {"iceServers": [{ 'url': 'stun:stun.l.google.com:19302' }]};
		   pc = new RTCPeerConnection(configuration);
		   var remoteView = document.querySelector('video');
		   // send any ice candidates to the other peer
		   pc.onicecandidate = function (evt) {
		      socket.emit('ice_candidate',{'to': "pratibha", 'candidate': event.candidate });
		   };
		   
		   // once remote stream arrives, show it in the remote video element
		   pc.onaddstream = function (evt) {
		      remoteView.src = URL.createObjectURL(evt.stream);
		   };
		   var isCaller=false;
		   // get the local stream, show it in the local video element and send it
		   navigator.mediaDevices.getUserMedia({ "audio": true, "video": true }, function (stream) {
		      remoteView.src = URL.createObjectURL(stream);
		      pc.addStream(stream);
		      
		      if (isCaller)
		         pc.createOffer(gotDescription);
		      
		      else
		         pc.createAnswer(pc.remoteDescription, gotDescription);
		         
		         
		   },function(err){
		   		alert(JSON.stringify(err))
		   })
		   function gotDescription(desc) {
		            pc.setLocalDescription(desc);
		            alert(JSON.stringify(desc))
		            socket.emit('start_chat', {'to': "ajay", 'sdp': desc })
		         }
		   socket.on('chatting',function (evt) {
		      	alert(JSON.stringify(evt))
		         //var signal = JSON.parse(evt.data);
		         pc.setRemoteDescription(new RTCSessionDescription(evt.sdp));
		      })
		   socket.on('isIceCandidate',function(){
		   	alert(JSON.stringify(data))
		   })
	</script>
	
</body>
</html>